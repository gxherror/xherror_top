---
title: "数据链路层MAC"
description: 学习
date: 2022-10-24T14:38:52Z
image: 
math: 
license: 
hidden: false
comments: true
categories:
    - NET
tags:
---
# 多路访问协议

![image-20221022163647775](/images/image-20221022163647775.png)
![image-20221022163647775](/images/image-20221022163647775.png)

## ALOHA

## pure ALOHA

![image-20221022171014240](/images/image-20221022171014240.png)
![image-20221022171014240](/images/image-20221022171014240.png)



## slotted-ALOHA

![image-20221022171034001](/images/image-20221022171034001.png)
![image-20221022171034001](/images/image-20221022171034001.png)



## CSMA(Carrier Sense Multiple Access)/CD

- 经侦听，如介质空闲，那么以 p的概率发送，以(1–p)的概率延迟一个时间单元发送
- 冲突窗口:发送站发出帧后能检测到冲突（碰撞）的最长时间(RTT)
- 如果发生冲突，等待一个随机分布的时间再继续监听

![image-20221022172602486](/images/image-20221022172602486.png)
![image-20221022172602486](/images/image-20221022172602486.png)

![image-20221022172242335](/images/image-20221022172242335.png)
![image-20221022172242335](/images/image-20221022172242335.png)



## 位图协议（预留协议）

- 竞争期：在自己的时槽内发送竞争比特
- 输期：按序发送,避免了冲突
- 在高负荷条件下：d/(d+N)，接近100%
- 位图协议无法考虑优先级

![image-20221022173144185](/images/image-20221022173144185.png)
![image-20221022173144185](/images/image-20221022173144185.png)

## 轮询协议

## 令牌环协议

- 发送的帧需要目的站或发送站将其从共享信道上去除；防止无限循环

![image-20221022173655376](/images/image-20221022173655376.png)
![image-20221022173655376](/images/image-20221022173655376.png)

## 二进制倒计数协议

- 有数据发送的站点从高序号到低序号排队，高者得到发送权
- 特点：高序号站点优先
- 信道的利用率为：d/(d+log 2 N)

![image-20221022173936730](/images/image-20221022173936730.png)
![image-20221022173936730](/images/image-20221022173936730.png)



## 自适应树搜索协议

![image-20221022174259765](/images/image-20221022174259765.png)
![image-20221022174259765](/images/image-20221022174259765.png)



# MAC协议

## MAC地址

![image-20221023104949623](/images/image-20221023104949623.png)
![image-20221023104949623](/images/image-20221023104949623.png)

例：

- 单播（unicast）： 5C-26-0A-7E-4E-4C
- 广播（broadcast）：FF-FF-FF-FF-FF-FF
- 组播（multicast）： 01-00-5E-00-00-0

## 协议

- DIX Ethernet V2 标准：类型段
- IEEE ' 802.3 标准：长度段

![image-20221023105244358](/images/image-20221023105244358.png)
![image-20221023105244358](/images/image-20221023105244358.png)

- 协议类型（Ether Types）：
  - IPv4: 0x0800
  - ARP: 0x0806
  - PPPoE: 0x8864
- 数据字段：46B-1500B(MTU)
  - 数据字段不足46字节，需要填充整数字节（Padding）至46字节，以保证以太网MAC帧不小于64字节
  - 最小帧长 = 46+18 = 64B
  - 凡长度小于 64 字节的帧都是由于冲突而异常中止的无效帧,**简单丢弃**
    - 10Mbps以太网，最大长度为2500米，RTT内能发送500bit
- 校验和(FCS, Frame Check Sequence)
  - 使用CRC32计算除了校验和以外的其他字段
  - 检查出的无效 MAC 帧就简单地丢弃

# hub/switch

- switch分隔冲突域，router分隔广播域

![image-20221023111921784](/images/image-20221023111921784.png)
![image-20221023111921784](/images/image-20221023111921784.png)

## switch的MAC表

- 逆向学习
  - 根据帧的**源地址**在MAC地址表查找匹配表项，
  - 如果没有，则增加一个新表项（源地址、入境端口、帧到达时间），
  - 如果有，则更新原表项的帧到达时间，**重置老化时间**。
- 对入境帧的转发过程（三选一），查帧的目的地址是否在MAC地址表中
  - 如果有，且入境端口≠出境端口，则从对应的出境端口转发帧；
  - 如果有，且入境端口=出境端口，则丢弃帧；
  - 如果没有或者是广播帧，则向除入境端口以外的其它所有端口泛洪帧。

- MAC表泛洪攻击

## 交换模式

- 存储转发模式（Store and Forward）
  - 转发前必须接收整个帧、执行CRC校验
  - 延迟大
  - 不转发出错帧、支持非对称交换
- 直通模式（Cut-through）
  - 一旦接收到帧的目的地址，就开始转发
  - 可能转发错误帧、不支持非对称交换
  - 延迟非常小，可以边入边出
- 无碎片模式（Fragment-free）
  - 接收到帧的**前64字节**，即开始转发
  - 仍可能转发错误帧，不支持非对称交换
  - **过滤了冲突碎片**，延迟和转发错帧介于存储转发和直通交换之间

## 生成树STP/快速生成树协议RSTP

https://info.support.huawei.com/info-finder/encyclopedia/zh/STP.html

避免物理环路

-  选举根桥(Root Bridge) 
   - 同一广播域只有一个根桥
   - 桥ID最小的交换机成为生成树的根
   - 根桥的所有端口都处在转发状态
-  为每个非根桥选出一个根端口（Root Port）
   - 具有最小根路径开销的端口被选作根端口
   - 非根桥只能有一个根端口，根端口处于转发状态
-  为每个网段确定一个指定端口（Designated Port）
   - 一个具有最小根路径开销的端口，作为该网段的指定端口
   - 指定端口处于转发状态，负责该网段的数据转发
   - 连接该网段的其他端口，若既不是指定端口，也不是根端口，则阻塞

![image-20221023120910223](/images/image-20221023120910223.png)
![image-20221023120910223](/images/image-20221023120910223.png)

## VLAN

一个VLAN（Virtual LAN）是一个独立的广播域，三层交换机/路由器通过划分VLAN，来分隔广播域

- 分类

  -  基于端口的VLAN（最常见）

  -  基于MAC地址的VLAN

  -  基于协议的VLAN

  -  基于子网的VLAN

- 优点
  - 广播流量被限制在一个VLAN内
  - VLAN间相互隔离,无法进行二层通信,不同VLAN需通过三层设备通信

![image-20221023121709534](/images/image-20221023121709534.png)
![image-20221023121709534](/images/image-20221023121709534.png)

![image-20221023122010673](/images/image-20221023122010673.png)
![image-20221023122010673](/images/image-20221023122010673.png)